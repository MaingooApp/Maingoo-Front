<div class="flex flex-col gap-6 relative items-start p-6 -m-6">
  <div class="flex-1 w-full min-w-0">
    <!-- MOBILE: Header Controls (Floating) -->
    <div class="flex md:hidden justify-between items-start mb-4 sticky top-0 z-20 pointer-events-none"
      *ngIf="productos.length > 0">
      <!-- Left: Search -->
      <div class="pointer-events-auto flex items-center gap-2 transition-all duration-300 ease-out"
        [class.w-full]="showMobileSearch" [class.mr-[165px]]="showMobileSearch">
        <button
          class="flex items-center justify-center rounded-full w-12 h-12 text-gray-600 bg-white/90 backdrop-blur-sm shadow-sm border border-gray-100 transition-all duration-200"
          [class.bg-maingoo-sage]="showMobileSearch" [class.text-white]="showMobileSearch"
          [class.border-transparent]="showMobileSearch" (click)="showMobileSearch = !showMobileSearch">
          <app-icon name="search" size="md"></app-icon>
        </button>

        <input *ngIf="showMobileSearch" type="text" pInputText placeholder="Buscar producto..."
          class="flex-1 h-12 shadow-lg rounded-full border-none pl-5 pr-4 text-base animate-fade-in bg-white/95 backdrop-blur-sm"
          (input)="filterProductos($event)" autofocus />
      </div>

      <!-- Right: Actions Group -->
      <div class="pointer-events-auto absolute right-0 top-0 flex items-center gap-3 shrink-0">
        <!-- Delete All (Mobile) -->
        <button
          class="w-12 h-12 rounded-full bg-white/90 backdrop-blur-sm shadow-sm border border-gray-100 text-red-500 flex items-center justify-center active:scale-95 transition-all"
          (click)="eliminarTodo()">
          <app-icon name="delete" size="md"></app-icon>
        </button>

        <!-- View Toggle Switch -->
        <div
          class="bg-white/90 backdrop-blur-sm shadow-sm border border-gray-100 rounded-full h-12 p-1 flex items-center gap-1">
          <button class="w-10 h-full rounded-full flex items-center justify-center transition-all duration-200"
            [class.bg-maingoo-sage]="viewMode === 'list'" [class.text-white]="viewMode === 'list'"
            [class.text-gray-400]="viewMode !== 'list'" (click)="setViewMode('list')">
            <app-icon name="view_headline" size="sm"></app-icon>
          </button>
          <button class="w-10 h-full rounded-full flex items-center justify-center transition-all duration-200"
            [class.bg-maingoo-sage]="viewMode === 'cards'" [class.text-white]="viewMode === 'cards'"
            [class.text-gray-400]="viewMode !== 'cards'" (click)="setViewMode('cards')">
            <app-icon name="grid_view" size="sm"></app-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- SECTION: Header & Actions (Desktop) -->
    <div class="hidden md:block">
      <app-section-header *ngIf="viewMode === 'list' || viewMode === 'cards'" title="Mi almacén" [viewMode]="viewMode"
        gridValue="cards" searchPlaceholder="Buscar un producto..." (viewModeChange)="setViewMode($any($event))"
        [showViewSwitcher]="productos.length > 0" [showSearch]="productos.length > 0"
        (search)="filterProductos($event)">
        <div actions class="flex items-center gap-2">
          <button pButton label="Subir Factura" severity="primary" (click)="openAddInvoiceModal()">
            <app-icon name="receipt_long" size="md"></app-icon>
          </button>
        </div>

        <!-- Controls (Right) -->
        <div controls *ngIf="productos.length > 0">
          <button pButton label="" class="p-button-danger p-button-outlined w-full sm:w-auto" (click)="eliminarTodo()"
            [disabled]="productos.length === 0 || cargando">
            <app-icon name="delete" size="md"></app-icon>
          </button>
        </div>
      </app-section-header>
    </div>

    <!-- SECTION: Empty State -->
    <div *ngIf="!cargando && productos.length === 0; else contenidoPrincipal">
      <app-empty-state icon="warehouse" title="No hay productos en tu almacén"
        description="Cuando escanees o subas una factura, esos productos, aparecerá aquí.">
      </app-empty-state>
    </div>

    <!-- SECTION: Main Layout (Table/Grid) -->
    <ng-template #contenidoPrincipal>
      <!-- LOADING: Skeleton States -->
      <ng-container *ngIf="cargando">
        <!-- Skeleton List View -->
        <app-skeleton *ngIf="viewMode === 'list'" mode="list" [count]="8"></app-skeleton>

        <!-- Skeleton Cards View (Categories) -->
        <app-skeleton *ngIf="viewMode === 'cards'" mode="grid" [count]="8"></app-skeleton>
      </ng-container>

      <!-- LOADED: Actual Content -->
      <ng-container *ngIf="!cargando">
        <!-- VIEW: List Mode & VIEW: Grid Mode Wrapper -->
        <div class="flex relative items-start" [class.gap-6]="!(selectedCategory && selectedProduct)"
          [class.gap-0]="selectedCategory && selectedProduct">
          <div
            [ngClass]="selectedCategory && selectedProduct ? 'w-0 overflow-hidden opacity-0 flex-none' : 'flex-1 min-w-0'"
            class="">
            <!-- VIEW: List Mode -->
            <div *ngIf="viewMode === 'list'"
              class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
              <!-- Mobile Compact List -->
              <div class="flex flex-col md:hidden">
                <div *ngFor="let item of filteredProducts" (click)="showDialog(item)"
                  class="border-b border-gray-100 last:border-0 p-3 flex items-center gap-3 active:bg-gray-50 transition-colors cursor-pointer relative"
                  [class.bg-maingoo-sage-50]="selectedProduct?.id === item.id">
                  <!-- Icon -->
                  <div
                    class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center shrink-0 border border-gray-100 text-maingoo-deep font-bold text-sm">
                    {{ item.name.charAt(0).toUpperCase() }}
                  </div>

                  <!-- Info -->
                  <div class="flex-1 min-w-0 flex flex-col gap-0.5">
                    <div class="flex justify-between items-center">
                      <h3 class="font-semibold text-[#1A3C34] text-sm truncate pr-2">{{ item.name }}</h3>
                      <span class="text-xs font-bold text-maingoo-deep whitespace-nowrap">{{
                        item.lastUnitPrice | currency: 'EUR'
                        }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-xs text-gray-500">
                      <div class="flex items-center gap-1 flex-wrap">
                        <ng-container *ngIf="item.subcategory?.category?.name">
                          <span
                            class="px-1.5 py-0.5 rounded-md text-[10px] uppercase font-bold tracking-wide truncate max-w-[80px]"
                            [ngStyle]="getCategoryStyle(item.subcategory?.category?.name)">
                            {{ item.subcategory?.category?.name }}
                          </span>
                          <span class="text-gray-300 text-[10px]">•</span>
                        </ng-container>
                        <span *ngIf="item.subcategory?.name"
                          class="px-1.5 py-0.5 rounded-md text-[10px] uppercase font-bold tracking-wide truncate max-w-[80px]"
                          [ngStyle]="getCategoryStyle(item.subcategory?.category?.name || item.subcategory?.name)">
                          {{ item.subcategory?.name }}
                        </span>
                      </div>
                      <span class="text-gray-300" *ngIf="item.subcategory?.name">|</span>
                      <span class="font-medium text-gray-600 truncate">Stock:
                        {{
                        (item.unit?.toUpperCase() === 'KG' ? item.unitCount : item.stock)
                        | number: (item.unit?.toUpperCase() === 'KG' ? '1.0-3' : '1.0-0')
                        }}
                        {{ item.unit }}</span>
                    </div>
                  </div>

                  <!-- Chevron -->
                  <app-icon name="chevron_right" size="xs" class="text-gray-300"></app-icon>
                </div>

                <!-- Empty State Mobile -->
                <div *ngIf="filteredProducts.length === 0" class="p-8 text-center text-gray-400 text-sm">
                  No se encontraron productos.
                </div>
              </div>

              <!-- Desktop Table -->
              <div class="hidden md:block">
                <p-table #dt [value]="productos" [rowHover]="true" styleClass="p-datatable-sm"
                  [globalFilterFields]="['name', 'eanCode', 'subcategory.name', 'subcategory.category.name', 'unit']"
                  [loading]="cargando">
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="text-maingoo-deep font-bold text-sm" [class.w-full]="selectedProduct"
                        [class.w-[30%]]="!selectedProduct">
                        Producto
                      </th>
                      <th class="text-maingoo-deep font-bold text-sm w-[20%]"
                        *ngIf="!selectedCategory && !selectedProduct">
                        Stock
                      </th>
                      <th class="text-maingoo-deep font-bold text-sm w-[20%]"
                        *ngIf="!selectedCategory && !selectedProduct">
                        Proveedor
                      </th>
                      <th class="text-maingoo-deep font-bold text-sm w-[20%]">Precio</th>
                      <th [class.w-[10%]]="!selectedProduct" [class.w-auto]="selectedProduct"></th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-item>
                    <tr class="cursor-pointer hover:bg-gray-50 transition-colors border-l-4 border-transparent"
                      [ngClass]="{ 'bg-gray-50 !border-maingoo-sage': selectedProduct?.id === item.id }"
                      (click)="showDialog(item)">
                      <td>
                        <div class="flex flex-col">
                          <span class="font-bold text-maingoo-deep text-base">{{ item.name }}</span>
                          <div class="flex items-center gap-1 mt-1 flex-wrap">
                            <ng-container *ngIf="item.subcategory?.category?.name">
                              <p-tag [value]="item.subcategory?.category?.name"
                                [style]="getCategoryStyle(item.subcategory?.category?.name)" [rounded]="true"
                                styleClass="text-xs font-normal border-0"></p-tag>
                              <app-icon name="chevron_right" size="xs" class="text-gray-400"></app-icon>
                            </ng-container>
                            <p-tag *ngIf="item.subcategory?.name" [value]="item.subcategory?.name"
                              [style]="getCategoryStyle(item.subcategory?.category?.name || item.subcategory?.name)"
                              [rounded]="true" styleClass="text-xs font-normal border-0"></p-tag>
                          </div>
                        </div>
                      </td>
                      <td *ngIf="!selectedCategory && !selectedProduct">
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                          <app-icon name="inventory_2" size="xs" class="text-maingoo-sage"></app-icon>
                          <span class="font-medium">{{
                            (item.unit?.toUpperCase() === 'KG' ? item.unitCount : item.stock)
                            | number: (item.unit?.toUpperCase() === 'KG' ? '1.0-3' : '1.0-0')
                            }}</span>
                          <span class="text-gray-400 text-xs">{{ item.unit }}</span>
                        </div>
                      </td>
                      <td *ngIf="!selectedCategory && !selectedProduct">
                        <div class="flex items-center gap-2 text-sm text-gray-600">
                          <app-icon name="local_shipping" size="xs" class="text-maingoo-sage"></app-icon>
                          <span *ngIf="item.supplier?.name" class="truncate max-w-[150px]">{{ item.supplier.name
                            }}</span>
                          <span *ngIf="!item.supplier?.name" class="text-gray-300 italic">Sin proveedor</span>
                        </div>
                      </td>
                      <td>
                        <span class="text-maingoo-deep font-bold text-sm">
                          {{ item.lastUnitPrice | currency: 'EUR' }}
                        </span>
                      </td>
                      <td class="text-right">
                        <button pButton
                          class="p-button-text p-button-secondary p-button-sm transition-transform duration-200"
                          [ngClass]="{ 'rotate-180 text-maingoo-sage': selectedProduct?.id === item.id }">
                          <app-icon name="chevron_left" size="md"></app-icon>
                        </button>
                      </td>
                    </tr>
                  </ng-template>
                  <!-- Empty State in Table -->
                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="5" class="text-center py-8 text-gray-500">No se encontraron productos.</td>
                    </tr>
                  </ng-template>
                </p-table>
              </div>
            </div>

            <!-- VIEW: Cards Mode (Categories) -->
            <div *ngIf="viewMode === 'cards'" class="grid gap-3 md:gap-6 animate-fade-in" [ngClass]="
              selectedCategory || selectedProduct ? 'grid-cols-1' : 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-5'
            ">
              <div *ngFor="let category of uniqueCategories" (click)="selectCategory(category.name)"
                class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md hover:border-maingoo-sage transition-all cursor-pointer group flex flex-col h-32 justify-between">
                <div class="flex items-start justify-between mb-4">
                  <h3
                    class="text-lg font-bold mb-2 transition-colors px-3 py-1 rounded-full w-auto inline-block bg-opacity-20"
                    [ngStyle]="getCategoryStyle(category.name)">
                    {{ category.name }}
                  </h3>
                </div>

                <div class="bg-gray-100 text-gray-600 text-xs font-bold px-2 py-1 rounded-md w-fit">
                  {{ category.count }} prod.
                </div>
              </div>
            </div>
          </div>

          <!-- SECTION: Unified Sidebar (Expanding Cards) -->
          <div *ngIf="selectedCategory || selectedProduct" [ngClass]="{
            'w-0 overflow-hidden opacity-0': !selectedCategory && !selectedProduct,
            'w-full md:w-3/4': (selectedCategory || selectedProduct) && !(selectedCategory && selectedProduct),
            'w-full': selectedCategory && selectedProduct
          }" class="hidden md:flex shrink-0 sticky top-4 h-[calc(100vh-2rem)] gap-6 z-20">
            <!-- Category Layer (Product List Card) -->
            <div *ngIf="selectedCategory" [ngClass]="selectedProduct ? 'flex-1 min-w-0' : 'w-full'"
              class="h-full rounded-2xl overflow-hidden shadow-2xl bg-white flex flex-col relative shrink-0">
              <!-- Header -->
              <div class="bg-gray-50 px-6 py-4 border-b border-gray-100 flex justify-between items-center shrink-0">
                <h2
                  class="text-xl font-bold mb-0 transition-colors px-3 py-1 rounded-full bg-opacity-20 flex items-center gap-2"
                  [ngStyle]="getCategoryStyle(selectedCategory)">
                  {{ selectedCategory }}
                </h2>
                <button (click)="closeCategoryDetail()"
                  class="p-button-rounded p-button-text text-gray-400 hover:text-gray-600 w-8 h-8 flex items-center justify-center transition-colors">
                  <app-icon name="close" size="md"></app-icon>
                </button>
              </div>

              <!-- Content -->
              <div class="flex-1 overflow-auto p-4">
                <p class="text-gray-500 mb-4 text-sm px-2">
                  Mostrando <strong>{{ categoryProducts.length }}</strong> productos en esta categoría.
                </p>

                <div class="h-full flex flex-col">
                  <p-table [value]="categoryProducts" [rowHover]="true" styleClass="p-datatable-sm" [scrollable]="true"
                    scrollHeight="flex">
                    <ng-template pTemplate="header">
                      <tr>
                        <th class="text-maingoo-deep font-bold text-sm bg-gray-50 border-gray-100">Producto</th>
                        <th class="text-maingoo-deep font-bold text-sm bg-gray-50 border-gray-100 w-24">Stock</th>
                        <th class="text-maingoo-deep font-bold text-sm bg-gray-50 border-gray-100">Proveedor</th>
                        <th class="text-maingoo-deep font-bold text-sm bg-gray-50 border-gray-100 w-24">Precio</th>
                        <th class="w-10 bg-gray-50 border-gray-100"></th>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-item>
                      <tr class="cursor-pointer hover:bg-gray-50 transition-colors border-l-4 border-transparent"
                        [ngClass]="{ 'bg-gray-50 !border-maingoo-sage': selectedProduct?.id === item.id }"
                        (click)="showDialog(item)">
                        <td class="border-gray-100">
                          <div class="flex flex-col">
                            <span class="font-bold text-maingoo-deep text-sm">{{ item.name }}</span>
                            <span class="text-xs text-gray-500" *ngIf="item.brand">{{ item.brand }}</span>
                            <div class="flex items-center gap-1 mt-1 flex-wrap">
                              <ng-container *ngIf="item.subcategory?.category?.name">
                                <span class="text-[10px] px-1.5 py-0.5 rounded bg-gray-100 text-gray-500 font-medium">
                                  {{ item.subcategory?.category?.name }}
                                </span>
                                <span class="text-[10px] text-gray-300">/</span>
                              </ng-container>
                              <span class="text-[10px] px-1.5 py-0.5 rounded font-medium"
                                [ngStyle]="getCategoryStyle(item.subcategory?.category?.name || item.subcategory?.name)"
                                *ngIf="item.subcategory?.name">
                                {{ item.subcategory?.name }}
                              </span>
                            </div>
                          </div>
                        </td>
                        <td class="border-gray-100">
                          <span class="text-gray-600 text-sm font-medium">{{
                            (item.unit?.toUpperCase() === 'KG' ? item.unitCount : item.stock)
                            | number: (item.unit?.toUpperCase() === 'KG' ? '1.0-3' : '1.0-0')
                            }}</span>
                          <span class="text-gray-400 text-xs ml-1">{{ item.unit }}</span>
                        </td>
                        <td class="border-gray-100">
                          <span class="text-gray-600 text-sm font-medium">{{ item.supplier?.name || '-' }}</span>
                        </td>
                        <td class="border-gray-100">
                          <span class="text-maingoo-deep font-bold text-sm">
                            {{ item.lastUnitPrice | currency: 'EUR' }}
                          </span>
                        </td>
                        <td class="text-right border-gray-100 px-2">
                          <app-icon name="chevron_right" size="xs" class="text-gray-300"></app-icon>
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                      <tr>
                        <td colspan="5" class="text-center py-8 text-gray-500">No se encontraron productos.</td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>

            <!-- Product Layer (Product Detail Card) -->
            <div *ngIf="selectedProduct"
              class="flex-1 h-full rounded-2xl overflow-hidden shadow-2xl bg-white flex flex-col relative">
              <app-product-detail-sidebar class="w-full h-full" [product]="selectedProduct" [relatedInvoices]="invoices"
                [priceChartData]="priceChartData" [priceChartOptions]="priceChartOptions" (close)="hideDialog()"
                (verFactura)="verFactura($event)"
                (delete)="confirmarEliminarProducto($event)"></app-product-detail-sidebar>
            </div>
          </div>

          <!-- MOBILE: Bottom Sheets (Keep Separate) -->

          <!-- Mobile Sheets moved to bottom -->
        </div>
        <!-- End of Row Wrapper -->
      </ng-container>
    </ng-template>
  </div>

  <!-- Mobile FAB (Floating Action Button) - Bottom Left -->
  <button
    class="md:hidden fixed bottom-24 right-6 w-14 h-14 rounded-full bg-[#1A3C34] dark:bg-[#6B9E86] text-white shadow-[0_4px_20px_rgba(26,60,52,0.25)] flex items-center justify-center active:scale-95 transition-all z-30 hover:shadow-[0_8px_24px_rgba(26,60,52,0.35)] hover:bg-[#15322b] dark:hover:bg-[#5a8671]"
    (click)="openAddInvoiceModal()" pTooltip="Subir factura" tooltipPosition="right">
    <app-icon name="add" size="xl"></app-icon>
  </button>
</div>
<!-- End of Main Container -->

<!-- MOVED MODALS -->

<!-- Category Mobile Sheet (Right Slide-over) -->
<ng-container *ngIf="selectedCategory">
  <div class="md:hidden fixed top-0 left-0 w-screen h-[100dvh] z-[3000] flex items-start justify-end overflow-hidden">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" (click)="closeCategoryDetail()"></div>

    <!-- Panel -->
    <div
      class="relative w-full h-full bg-gray-50 shadow-2xl flex flex-col animate-slide-left overflow-hidden max-w-[100vw]"
      (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)">
      <!-- Header -->
      <div
        class="flex items-center justify-center px-4 py-3 bg-white border-b border-gray-100 shrink-0 sticky top-0 z-10 w-full relative">
        <h2
          class="text-lg font-bold truncate max-w-[70%] px-4 py-1.5 rounded-full transition-colors flex items-center justify-center"
          [ngStyle]="getCategoryStyle(selectedCategory)">
          {{ selectedCategory }}
        </h2>
        <button
          class="absolute right-4 w-8 h-8 rounded-full bg-gray-100 text-gray-400 flex items-center justify-center active:bg-gray-200 transition-colors shrink-0"
          (click)="closeCategoryDetail()">
          <app-icon name="close" size="sm"></app-icon>
        </button>
      </div>

      <!-- Content (Grid) -->
      <div class="flex-1 overflow-y-auto overflow-x-hidden p-4 pb-20 w-full">
        <div class="grid grid-cols-2 gap-3">
          <div *ngFor="let item of categoryProducts" (click)="showDialog(item)"
            class="bg-white rounded-xl p-2 shadow-sm border border-gray-100 flex flex-col gap-2 active:scale-95 transition-transform">
            <!-- Icon/Placeholder -->
            <div
              class="w-full h-24 rounded-lg bg-gray-50 flex items-center justify-center mb-1 relative overflow-hidden">
              <span class="text-2xl font-bold text-gray-300">{{ item.name.charAt(0) }}</span>
              <!-- Stock Badge -->
              <div
                class="absolute bottom-1 right-1 bg-white/90 backdrop-blur-sm px-1.5 py-0.5 rounded text-[10px] font-bold text-gray-600 shadow-sm border border-gray-100">
                {{ (item.unit?.toUpperCase() === 'KG' ? item.unitCount : item.stock) | number: '1.0-0' }}
              </div>
            </div>

            <!-- Info -->
            <div class="flex flex-col">
              <h3 class="font-bold text-maingoo-deep text-sm leading-tight line-clamp-2 min-h-[2.5em]">
                {{ item.name }}
              </h3>
              <div class="flex items-end justify-between mt-2">
                <span class="text-maingoo-sage font-bold text-sm">{{ item.lastUnitPrice | currency: 'EUR' }}</span>
                <span class="text-[10px] text-gray-400">{{ item.unit }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Navigation (Dots) -->
      <div class="fixed bottom-6 left-0 right-0 flex justify-center z-20 pointer-events-none">
        <div
          class="bg-black/40 backdrop-blur-md rounded-full px-4 py-2 flex items-center gap-2 pointer-events-auto shadow-lg">
          <button class="w-6 h-6 rounded-full flex items-center justify-center text-white/80 active:text-white"
            (click)="prevCategory()">
            <app-icon name="chevron_left" size="xs"></app-icon>
          </button>

          <div class="flex items-center gap-1.5 overflow-x-auto max-w-[120px] no-scrollbar px-1">
            <div *ngFor="let cat of uniqueCategories; let i = index"
              class="w-1.5 h-1.5 rounded-full transition-all duration-300 shrink-0"
              [ngClass]="currentCategoryIndex === i ? 'bg-white scale-125' : 'bg-white/30'"></div>
          </div>

          <button class="w-6 h-6 rounded-full flex items-center justify-center text-white/80 active:text-white"
            (click)="nextCategory()">
            <app-icon name="chevron_right" size="xs"></app-icon>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<!-- Product Mobile Sheet -->
<ng-container *ngIf="selectedProduct">
  <div class="md:hidden fixed inset-0 z-[3001] flex items-end justify-center">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" (click)="hideDialog()"></div>
    <div
      class="relative w-full h-[85vh] bg-white rounded-t-3xl shadow-[0_-4px_30px_rgba(0,0,0,0.15)] flex flex-col animate-slide-up overflow-hidden">
      <div class="w-full flex justify-center pt-4 pb-2 bg-white shrink-0 cursor-grab active:cursor-grabbing"
        (click)="hideDialog()">
        <div class="w-12 h-1.5 bg-gray-300 rounded-full"></div>
      </div>
      <div class="flex-1 overflow-hidden relative flex flex-col">
        <app-product-detail-sidebar class="w-full h-full" [product]="selectedProduct" [relatedInvoices]="invoices"
          [priceChartData]="priceChartData" [priceChartOptions]="priceChartOptions" (close)="hideDialog()"
          (verFactura)="verFactura($event)" (delete)="confirmarEliminarProducto($event)"></app-product-detail-sidebar>
      </div>
    </div>
  </div>
</ng-container>