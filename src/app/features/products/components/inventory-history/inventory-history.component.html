<div class="flex flex-col md:flex-row gap-6 animate-fade-in fade-in h-full items-start">
        
  <!-- Left Side: History List -->
  <div class="flex-1 w-full min-w-0 flex flex-col h-full transition-all duration-300">
      <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-gray-100 flex items-center gap-4">
          <button pButton icon="pi pi-arrow-left" class="p-button-danger p-button-text p-button-rounded" (click)="back.emit()"></button>
          <div class="flex flex-col">
              <h2 class="text-2xl font-bold text-maingoo-deep m-0">Mis Inventarios</h2>
          </div>
      </div>
       
       <div class="grid grid-cols-1 gap-3 overflow-y-auto max-h-[calc(100vh-12rem)] pr-2">
      <!-- Empty State -->
      <div *ngIf="savedInventories.length === 0" class="col-span-full">
          <div class="bg-white rounded-xl border border-dashed border-gray-300 p-12 text-center">
              <div class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="pi pi-history text-3xl text-gray-400"></i>
              </div>
              <h3 class="text-lg font-semibold text-gray-700">No hay históricos</h3>
              <p class="text-gray-500 mt-1">Aún no has guardado ningún inventario.</p>
              <button pButton label="Crear uno ahora" class="p-button-text mt-4 text-maingoo-sage" (click)="create.emit()"></button>
          </div>
      </div>

      <!-- History Grid -->
      <!-- Use conditional grid columns based on width -->
      <div [class]="selectedInventoryRecord ? 'grid grid-cols-1 gap-4' : 'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6'">
          <div *ngFor="let record of savedInventories" 
               class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 hover:shadow-md transition-all cursor-pointer group"
               [ngClass]="{'ring-2 ring-maingoo-sage border-transparent': selectedInventoryRecord === record}"
               (click)="onSelect(record)">
              <div class="flex justify-between items-start mb-3">
                  <div class="w-10 h-10 rounded-full bg-maingoo-sage/10 flex items-center justify-center text-maingoo-sage group-hover:bg-maingoo-sage group-hover:text-white transition-colors">
                      <i class="pi pi-file text-xl"></i>
                  </div>
                  <span class="text-xs text-gray-400 font-medium bg-gray-50 px-2 py-1 rounded">{{ record.date | date:'shortTime' }}</span>
              </div>
              
              <h3 class="font-bold text-maingoo-deep text-lg mb-1">{{ record.date | date:'dd/MM/yyyy' }}</h3>
              <p class="text-sm text-gray-500 mb-4">{{ record.itemsCount }} productos registrados</p>
              
              <div class="flex gap-2 w-full">
                   <button pButton label="Ver detalle" class="p-button-outlined p-button-sm w-full text-xs" [class.p-button-secondary]="selectedInventoryRecord !== record"></button>
              </div>
          </div>
      </div>
  </div>
  </div>

  <!-- Right Side: Detail Sidebar -->
  <div *ngIf="selectedInventoryRecord" class="w-full md:w-1/2 shrink-0 bg-white rounded-xl shadow-lg border border-gray-100 flex flex-col animate-slide-in-right sticky top-4 max-h-[calc(100vh-2rem)] overflow-y-auto">
       <div class="p-4 border-b border-gray-100 bg-gray-50 flex justify-between items-center sticky top-0 bg-gray-50 z-10">
           <div>
              <h3 class="font-bold text-maingoo-deep text-lg">Inventario de {{ getFormattedCategoryNames(selectedInventoryRecord.categoryNames) }}</h3>
              <p class="text-sm text-gray-500">{{ selectedInventoryRecord.date | date:'dd/MM/yyyy HH:mm' }}</p>
           </div>
           <div class="flex gap-2">
              <button 
                  pButton 
                  icon="pi pi-trash" 
                  class="p-button-rounded p-button-text p-button-danger" 
                  (click)="onDelete(selectedInventoryRecord)"
                  pTooltip="Eliminar inventario"
                  tooltipPosition="bottom"></button>
              <button 
                  pButton 
                  icon="pi pi-times" 
                  class="p-button-rounded p-button-text p-button-secondary" 
                  (click)="closeDetail.emit()"></button>
           </div>
       </div>
       
       <div class="p-0">
          <p-table
            [value]="selectedInventoryRecord.items"
            [rowHover]="true"
            styleClass="p-datatable-sm"
            [paginator]="true"
            [rows]="10"
            [globalFilterFields]="['name']">
            <ng-template pTemplate="header">
              <tr>
                <th class="text-maingoo-deep font-bold text-xs">Producto</th>
                <th class="text-maingoo-deep font-bold text-xs w-24 bg-maingoo-mint/10">Inventario</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
              <tr>
                <td class="text-sm">
                  <div class="flex flex-col">
                    <span class="font-bold text-maingoo-deep">{{ item.name }}</span>
                    <div *ngIf="item.category?.name" class="mt-0.5">
                      <p-tag [value]="item.category.name" [style]="getCategoryStyle(item.category.name)" [rounded]="true" styleClass="text-[10px] font-normal border-0"></p-tag>
                    </div>
                  </div>
                </td>
                <td class="text-sm text-right bg-maingoo-mint/5">
                  <span class="font-bold text-maingoo-deep px-2">{{ item.manualInventory !== null ? item.manualInventory : '-' }}</span>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="2" class="text-center py-4 text-gray-500 text-xs">No hay items.</td>
                </tr>
            </ng-template>
          </p-table>
       </div>
  </div>

</div>
