<div class="h-full rounded-2xl overflow-hidden shadow-2xl bg-white flex flex-col relative shrink-0">
	<!-- Header -->
	<div
		class="px-6 py-4 border-b border-gray-100 flex items-center justify-between shrink-0 bg-white z-10 sticky top-0">
		<div class="flex items-center gap-3">
			<h2 class="text-xl font-bold transition-colors px-3 py-1 rounded-full bg-opacity-20 flex items-center gap-2"
				[ngStyle]="getCategoryStyle(categoryName)">
				{{ categoryName }}
			</h2>
		</div>
		<button
			class="w-8 h-8 rounded-full hover:bg-gray-100 flex items-center justify-center text-gray-500 transition-colors"
			(click)="onClose()">
			<app-icon name="close" size="sm"></app-icon>
		</button>
	</div>

	<!-- Content -->
	<div class="flex-1 overflow-y-auto p-6 content-start">
		<ng-container *ngFor="let node of categoryTree">
			<ng-container *ngTemplateOutlet="nodeTemplate; context: { $implicit: node }"></ng-container>
		</ng-container>

		<!-- Recursive Template -->
		<ng-template #nodeTemplate let-node>
			<div class="mb-6 last:mb-0">
				<!-- Category Title (Bio/Header style) -->
				<div *ngIf="node.products.length > 0 || node.children.length > 0" class="flex items-center gap-2 mb-3">
					<h3 class="text-sm uppercase tracking-wider font-bold px-3 py-1 rounded-full bg-opacity-20 flex items-center gap-2 w-fit transition-colors"
						[ngStyle]="getCategoryStyle(categoryName)">
						<!-- Optional: Add icon or styling based on level -->
						<span *ngIf="node.level > 0" class="opacity-50"></span>
						{{ node.name }}
					</h3>
					<div class="h-px bg-gray-100 flex-1"></div>
				</div>

				<!-- Products in this category -->
				<div *ngIf="node.products.length > 0" class="mb-4 pl-0">
					<app-product-list [products]="node.products" [selectedProduct]="selectedProduct" [isNested]="true"
						(selectProduct)="onSelectProduct($event)">
					</app-product-list>
				</div>

				<!-- Recursion for children -->
				<div *ngIf="node.children.length > 0" class="pl-4 border-l border-gray-100 ml-1">
					<ng-container *ngFor="let child of node.children">
						<ng-container *ngTemplateOutlet="nodeTemplate; context: { $implicit: child }"></ng-container>
					</ng-container>
				</div>
			</div>
		</ng-template>

		<!-- Fallback if no products -->
		<div *ngIf="products.length === 0" class="flex flex-col items-center justify-center py-12 text-gray-400">
			<app-icon name="inventory_2" size="xl" class="mb-2 opacity-50"></app-icon>
			<p class="text-sm">No hay productos en esta categor√≠a</p>
		</div>
	</div>
</div>